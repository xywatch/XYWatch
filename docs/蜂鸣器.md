# ESP32驱动MLT-5020无源蜂鸣器

## 硬件连接

### 电路原理图
```
ESP32 GPIO25 ----[1KΩ]----+     // R20很重要，不能省略！
                          |
                     B    |
                     +----+
                     |    |
GND -------------[10KΩ]   | C     MLT-5020
                          |      +--------+
                          +------|  BEEP  |
                     E         + |        |
                     |           +--------+
                     |              -
                     |
                    GND             |
                                  3.3V
```

### 元件清单
- MLT-5020：贴片无源蜂鸣器
- SS8050：NPN三极管
- R20：1KΩ 电阻（限流，不可省略）
- R21：10KΩ 电阻（下拉）
- 连接线

### 连接说明
1. ESP32 GPIO25（可配置）通过1KΩ电阻连接到三极管基极(B)
   - 1KΩ电阻用于限制基极电流，保护三极管和ESP32
   - 计算：(3.3V - 0.7V) / 1KΩ ≈ 2.6mA 基极电流
2. 三极管发射极(E)接地
3. 三极管集电极(C)连接到蜂鸣器负极
4. 蜂鸣器正极接3.3V
5. 三极管基极通过10KΩ电阻下拉到地

### 关于限流电阻R20的说明
1. 保护作用：
   - 限制三极管基极电流，防止损坏三极管
   - 保护ESP32的GPIO输出端口
   - 防止瞬间大电流损坏器件

2. 技术必要性：
   - 三极管基极-发射极是PN结构
   - PN结导通电压约0.7V
   - 无限流电阻时3.3V直接加在PN结上会产生过大电流
   - 1KΩ电阻将基极电流限制在安全范围内（约2.6mA）

3. 选择依据：
   - 输入电压：3.3V（ESP32 GPIO输出）
   - BE结压降：0.7V（三极管特性）
   - 目标基极电流：2-3mA（合适的驱动电流）
   - 因此选择1KΩ电阻最为合适

## 工作原理
1. 当ESP32输出高电平时，三极管导通，蜂鸣器接地工作
2. 当ESP32输出低电平时，三极管截止，蜂鸣器停止工作
3. 三极管起到了放大电流的作用，可以提供更大的驱动能力

优点:
1. 保护ESP32 IO口，避免大电流
2. 驱动能力更强，声音可能会更响
3. 电路可靠性更高

### 无源蜂鸣器vs有源蜂鸣器
1. 无源蜂鸣器：
   - 没有内置振荡电路
   - 需要外部提供交流信号（方波）来驱动
   - 可以发出不同频率的声音
   - 功耗较低
   - 适合播放音乐

2. 有源蜂鸣器：
   - 内置振荡电路
   - 只需直流电即可发声
   - 只能发出固定频率声音
   - 使用简单但功耗较高

### 驱动方案说明
1. 使用三极管驱动的优点：
   - 保护ESP32 IO口，避免大电流
   - 提供更强的驱动能力
   - 提高电路可靠性

2. PWM控制：
   - 使用ESP32的LEDC模块产生PWM信号
   - 通过改变频率控制音调
   - 通过改变占空比控制音量
   - 信号经过三极管反相后驱动蜂鸣器

## 软件实现

### 关键参数
```cpp
#define LEDC_CHANNEL_0     0
#define LEDC_TIMER_13_BIT  13
#define LEDC_BASE_FREQ     4000  // MLT-5020谐振频率
#define BUZZER_PIN         25    // GPIO引脚
```

### 音量控制
```cpp
// 音量等级（0-3）
case 0: volume = 0;     // 静音
case 1: volume = 1024;  // 25%音量
case 2: volume = 2048;  // 50%音量
case 3: volume = 4095;  // 100%音量
```

### 频率范围
- 最佳工作频率：4000Hz
- 有效范围：3500-4500Hz
- 超出范围自动限制在有效范围内

### 注意事项
1. 由于使用三极管反相，PWM占空比需要反转：
```cpp
volume = 4095 - volume;  // 反转占空比
```

2. MLT-5020虽然标注正负极，但实际是无极性的
3. PCB布局时建议按标注方向安装，保持一致性
4. 使用回流焊或小心使用电烙铁焊接

## 使用示例
```cpp
// 初始化
buzzer_init();

// 播放UI音效（中等优先级）
buzzer_buzz(500, 4000, VOL_UI, PRIO_MED, NULL);

// 播放闹钟声音（高优先级）
buzzer_buzz(1000, 4000, VOL_ALARM, PRIO_HIGH, NULL);

// 在主循环中更新
buzzer_update();
``` 